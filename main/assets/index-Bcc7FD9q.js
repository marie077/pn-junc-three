import*as o from"https://unpkg.com/three@0.163.0/build/three.module.js";import{MathUtils as Te}from"https://unpkg.com/three@0.163.0/src/math/MathUtils.js";import{ImprovedNoise as ht}from"https://unpkg.com/three@0.163.0/examples/jsm/math/ImprovedNoise.js";import*as jt from"https://unpkg.com/three@0.163.0/examples/jsm/utils/BufferGeometryUtils.js";import{Vector3 as $e}from"https://unpkg.com/three@0.163.0/src/math/Vector3.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/TransformControls.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/OrbitControls.js";import{XRButton as St}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRButton.js";import{XRControllerModelFactory as Pt}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRControllerModelFactory.js";import{TextGeometry as Ge}from"https://unpkg.com/three@0.163.0/examples/jsm/geometries/TextGeometry.js";import{FontLoader as Ft}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/FontLoader.js";import{RGBELoader as Lt}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/RGBELoader.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const zt="/assets/moonless_golf_1k.hdr";let q,U,g,P,W,ie;const Je=document.getElementById("voltage");let _=.22,me=.88,xe,u=[],p=[],z=50,d=new o.Vector3(150,75,75),$t=new o.Clock;d.y;let Gt=-(d.x/2)+1,qt=d.x/2-1,Ie,F=25,Qe,et,be,T=0,Bt="Voltage: "+T,fe,Le;const Et=.1;let Rt=.5,A=2;const k=new ht;let N=[],K=[],Oe=[],tt=30,Ne=!1,ot=!1,nt=!1,Ve=[],oe,ne,ve,he,B;const se={leftController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1},rightController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1}},Ae={moveSpeed:2,rotationSpeed:.05},Ze=new Ft;_t();Dt();setInterval(()=>{Wt()},2e3);function _t(){const t=[{nv:.1,quantity:3},{nv:.2,quantity:10},{nv:.3,quantity:21},{nv:.4,quantity:35},{nv:.5,quantity:49},{nv:.6,quantity:63},{nv:.7,quantity:74},{nv:.8,quantity:82},{nv:.9,quantity:86},{nv:1,quantity:86},{nv:1.1,quantity:83},{nv:1.2,quantity:77},{nv:1.3,quantity:69},{nv:1.4,quantity:59},{nv:1.5,quantity:50},{nv:1.6,quantity:40},{nv:1.7,quantity:32},{nv:1.8,quantity:24},{nv:1.9,quantity:18},{nv:3,quantity:13},{nv:2.1,quantity:9},{nv:2.2,quantity:6},{nv:2.3,quantity:4},{nv:3.5,quantity:3},{nv:4,quantity:2},{nv:5,quantity:1},{nv:6,quantity:1}];for(let m=0;m<t.length;m++){let h=0;for(;h<t[m].quantity;)Oe.push(t[m].nv),h++}if(q=document.getElementById("three-container-scene-1"),g=new o.Scene,new Lt().load(zt,function(m){m.mapping=o.EquirectangularReflectionMapping,m.format=o.RGBAFormat,m.minFilter=o.LinearFilter,m.magFilter=o.LinearFilter,m.generateMipmaps=!1,g.environment=m,g.background=m}),U=new o.PerspectiveCamera(75,q.clientWidth/q.clientHeight,.1,1500),U.position.z=150,P=new o.WebGLRenderer({alpha:!1}),P.setSize(q.clientWidth,q.clientHeight),P.xr.enabled=!0,P.xr.setReferenceSpaceType("local-floor"),It(),q.appendChild(P.domElement),q.appendChild(St.createButton(P)),B=new o.Object3D,Ut(),!q){console.error("Container not found");return}const e=new o.AmbientLight(16777215,3);g.add(e),ie=new dat.GUI,W={translateZ:150,translateX:0,rotateY:Te.degToRad(0)},document.getElementById("myText").innerHTML=0,ie.add(W,"translateX",-100,100).onChange(()=>{U.position.x=W.translateX}),ie.add(W,"translateZ",-50,150).onChange(()=>{U.position.z=W.translateZ}),ie.add(W,"rotateY",-50,50).onChange(()=>{U.rotation.y=Te.degToRad(W.rotateY)});const n={"Reset Cube":eo};ie.add(n,"Reset Cube"),Je.addEventListener("input",()=>{T=parseFloat(Je.value),document.getElementById("myText").innerHTML=T}),window.addEventListener("resize",oo),Ze.load("https://unpkg.com/three@0.163.0/examples/fonts/helvetiker_regular.typeface.json",function(m){Ze._font=m,Le=new Ge(Bt,{font:m,size:5,depth:.5});const h=new o.MeshBasicMaterial({color:16777215});fe=new o.Mesh(Le,h),fe.position.set(-20,60,0),g.add(fe)});const i=new o.CurvePath,r=[new o.Vector3(-75,0,10),new o.Vector3(-120,0,10),new o.Vector3(-120,-65,10),new o.Vector3(-30,-65,10)];for(let m=0;m<r.length-1;m++){const h=new o.LineCurve3(r[m],r[m+1]);i.add(h)}const a=new o.BufferGeometry().setFromPoints(i.getPoints(50)),s=new o.LineBasicMaterial({color:16777215}),c=new o.Line(a,s);g.add(c);const l=new o.CurvePath,j=[new o.Vector3(75,0,10),new o.Vector3(120,0,10),new o.Vector3(120,-65,10),new o.Vector3(30,-65,10)];for(let m=0;m<j.length-1;m++){const h=new o.LineCurve3(j[m],j[m+1]);l.add(h)}const w=new o.BufferGeometry().setFromPoints(l.getPoints(50)),x=new o.LineBasicMaterial({color:16777215}),qe=new o.Line(w,x);g.add(qe);const Be=Vt(d.x,d.y,d.z),Ee=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});xe=new o.LineSegments(Be,Ee),xe.computeLineDistances(),xe.position.set(0,0,0);const Re=new o.CylinderGeometry(10,10,60,32),_e=new o.WireframeGeometry(Re),G=new o.LineSegments(_e);G.rotateZ(Math.PI/2),G.material.depthTest=!1,G.material.opacity=.25,G.material.transparent=!0,G.position.set(0,-70,0),g.add(G);const De=new o.PlaneGeometry(d.z,d.y),Ue=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});let ee=new o.LineSegments(De,Ue);ee.computeLineDistances(),ee.position.set(0,0,0),ee.rotateY(Math.PI/2),g.add(xe,ee);let te;for(let m=0;m<z;m++){te=H();let h=ct(m,-(d.x/2)+1,-2,16724273,!1);st(-(d.x/2)+1,-2,16777215,"acceptor"),p.push({value:"h",initPos:h.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:h.object,material:h.material,velocity:te,speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(m*100,m*200,performance.now()*.001)-.5)*.3})}for(let m=0;m<z;m++){te=H(),st(2,d.x/2-1,16777215,"donor");let h=ct(m,2,d.x/2-1,2052607,!1);u.push({value:"e",initPos:h.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:h.object,material:h.material,velocity:te,speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(m*100,m*200,performance.now()*.001)-.5)*.3})}}function Dt(){P.setAnimationLoop(function(t,e){if(e){const c=e.session;if(c){let l={left:!1,right:!1};Array.from(c.inputSources).forEach(w=>{if(!w.gamepad)return;const x=w.handedness==="left"?se.leftController:se.rightController;w.gamepad.axes.length>=4&&(x.thumbstick.x=w.gamepad.axes[2]||0,x.thumbstick.y=w.gamepad.axes[3]||0,x.trigger=Math.abs(w.gamepad.buttons[0].value),x.triggerPressed=x.trigger>Et,x===se.rightController&&x.triggerPressed&&!l.right?(T=Math.min(.4,T+.1),l.right=x.triggerPressed):x===se.leftController&&x.triggerPressed&&!l.left&&(T=Math.max(-1.4,T-.1),l.left=x.triggerPressed),fe&&(fe.geometry.dispose(),Le=new Ge("Voltage: "+T.toFixed(2),{font:Ze._font,size:5,depth:.5}),fe.geometry=Le))})}}let n=performance.now(),i=$t.getDelta()/15;g.remove(be),F=24.2*(.58*Math.sqrt(9.2-T*1.13/.05)),Qe=Vt(F,d.y,d.z),et=new o.LineDashedMaterial({color:16711680,dashSize:3,gapSize:1}),be=new o.LineSegments(Qe,et),be.computeLineDistances(),be.position.set(0,0,0),g.add(be);let r=new o.Vector3(F/2,0,0);if(to(r,F,16776960),Jt(n),lt(u,F,i,-1),lt(p,F,i,1),Yt(),Nt(),Zt(),T<0&&(je(u,"e"),je(p,"h")),T>0&&(je(u,"e"),je(p,"h"),Ne)){let c=new o.Vector3(d.x/2+50,0,0),l=ue(c,2052607,!1);l.value="e",N.push(l);let j=new o.Vector3(-d.x/2-50,0,0),w=ue(j,16724273,!1);w.value="h",N.push(w)}N.length>0&&Ht(),K.length>0&&kt(),Ot(),Qt(p,u,Gt,qt),At(),P.render(g,U)})}function rt(t){let e,n;switch(t.targetRayMode){case"tracked-pointer":return e=new o.BufferGeometry,e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new o.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new o.LineBasicMaterial({vertexColors:!0,blending:o.AdditiveBlending}),new o.Line(e,n);case"gaze":return e=new o.RingGeometry(.02,.04,32).translate(0,0,-1),n=new o.MeshBasicMaterial({opacity:.5,transparent:!0}),new o.Mesh(e,n)}}function Ut(){B=new o.Object3D,B.position.set(0,0,0),B.add(U),g.add(B),oe=P.xr.getController(0),ne=P.xr.getController(1),oe.addEventListener("selectstart",at),oe.addEventListener("selectend",it),oe.addEventListener("connected",function(e){this.add(rt(e.data))}),oe.addEventListener("disconnected",function(){this.remove(this.children[0])}),ne.addEventListener("selectstart",at),ne.addEventListener("selectend",it),ne.addEventListener("connected",function(e){this.add(rt(e.data))}),ne.addEventListener("disconnected",function(){this.remove(this.children[0])});const t=new Pt;ve=P.xr.getControllerGrip(0),he=P.xr.getControllerGrip(1),ve.add(t.createControllerModel(ve)),he.add(t.createControllerModel(he)),B.add(oe),B.add(ne),B.add(ve),B.add(he)}async function It(t){const e=await navigator.xr.requestSession("immersive-vr"),n=e.inputSources[0];ve=e.requestReferenceSpace("local"),console.log("number of input sources:"+n.length)}function At(){if(!P.xr.isPresenting)return;const t=se.leftController.thumbstick,e=se.rightController.thumbstick;Math.abs(t.y)>.1&&(B.position.z+=t.y*Ae.moveSpeed),Math.abs(t.x)>.1&&(B.position.x+=t.x*Ae.moveSpeed),Math.abs(e.x)>.1&&(B.rotation.y-=e.x*Ae.rotationSpeed)}function at(){this.userData.isSelecting=!0}function it(){this.userData.isSelecting=!1}function kt(){for(let t=K.length-1;t>=0;t--){let e=K[t],n=e.object.position;if(e.value=="e")if(n.x<=d.x/2)e.object.position.add(new o.Vector3(.2,0,0));else{e.object.position.add(new o.Vector3(.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x-d.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(g.remove(e.object),K.splice(t,1))}else if(e.value=="h")if(n.x>=-d.x/2)e.object.position.add(new o.Vector3(-.2,0,0));else{e.object.position.add(new o.Vector3(-.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x+d.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(g.remove(e.object),K.splice(t,1))}}}function Ht(){for(let t=N.length-1;t>=0;t--){let e=N[t],n=e.object.position;e.value=="e"?n.x<d.x/2-1?(u.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:H(),speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),N.splice(t,1)):e.object.position.add(new o.Vector3(-.2,0,0)):e.value=="h"&&(n.x>-d.x/2+1?(p.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:H(),speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),N.splice(t,1)):e.object.position.add(new o.Vector3(.2,0,0)))}}function je(t,e){let n=0,i=0;for(let r=0;r<t.length;r++){let a=t[r].object.position.x;if(T<0||T>0){if(e=="e"){if(a>F/2&&(n=n+1,n>z)){n=n-1;let s=new o.Vector3(d.x/2-5,0,0),c=ue(s,2052607,!1);c.value="e",t[r].crossed=!0,K.push(c);let l=Math.floor(Math.random()*u.length);g.remove(u[l].object),u[l].object.geometry.dispose(),u[l].object.material.dispose(),u.splice(l,1)}}else if(e=="h"&&a<-F/2&&(i=i+1,i>z)){i=i-1;let s=new o.Vector3(-d.x/2+5,0,0),c=ue(s,16724273,!1);c.value="h",t[r].crossed=!0,K.push(c);let l=Math.floor(Math.random()*p.length);g.remove(p[l].object),p[l].object.geometry.dispose(),p[l].object.material.dispose(),p.splice(l,1)}}if(T===0){if(e=="e"){if(a>F/2&&(n=n+1,n>z)){n=n-1;let s=Math.floor(Math.random()*u.length);g.remove(u[s].object),u[s].object.geometry.dispose(),u[s].object.material.dispose(),u.splice(s,1)}}else if(e=="h"&&a<-F/2&&(i=i+1,i>z)){i=i-1;let s=Math.floor(Math.random()*p.length);g.remove(p[s].object),p[s].object.geometry.dispose(),p[s].object.material.dispose(),p.splice(s,1)}}}}function lt(t,e,n,i){for(let r=0;r<t.length;r++){let a=t[r].object.position.x,s=new o.Vector3(0,0,0);-e/2<a&&a<0&&(s=new o.Vector3(-1.53*(e/2+a),0,0)),0<a&&a<e/2&&(s=new o.Vector3(-1.53*(e/2-a),0,0)),(-d.x/2+1<a&&a<-e/2||e/2<a&&a<d.x/2-1||a==0)&&(s=new o.Vector3(0,0,0)),i<0?u[r].velocity.add(s.multiplyScalar(n).multiplyScalar(i)):p[r].velocity.add(s.multiplyScalar(n))}}function Ot(){for(let n of[...u,...p]){const i=n.velocity.clone();i.clampLength(.9,30),n.canMove==!0&&(n.object.position.add(i),n.velocity=i)}}function Zt(){let i;for(let r=0;r<u.length;r++)for(let a=0;a<p.length;a++)!u[r]||!p[a]||(ot=u[r].object.position.x<-F/2-20||u[r].object.position.x>F/2+20,nt=p[a].object.position.x<-F/2-20||p[a].object.position.x>F/2+20,ot&&nt&&(Kt(u[r],p[a])?!u[r].lerping&&!p[a].lerping&&(u[r].lerping=!0,p[a].lerping=!0,u[r].lerpPartner=p[a],p[a].lerpPartner=u[r],u[r].pauseCounter=0,p[a].pauseCounter=0,u[r].lerpProgress=0,p[a].lerpProgress=0,u[r].velocity.set(0,0,0),p[a].velocity.set(0,0,0),i=new o.Vector3().addVectors(u[r].object.position,p[a].object.position).multiplyScalar(.5),u[r].targetPosition=i.clone(),p[a].targetPosition=i.clone()):Ne=!1));for(let r of[...u,...p])if(r.processed=!1,r.lerping&&!r.processed)if(r.processed=!0,console.log("lerping detected"),r.orbCreated=!1,r.pauseCounter<60)r.pauseCounter++;else{if(r.lerpProgress+=.01,r.object.position.lerp(r.targetPosition,r.lerpProgress),r.lerpProgress<=.25&&!r.orb&&!r.orbCreated){const a=new o.SphereGeometry(3,32,32),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),c=new o.Mesh(a,s);c.position.copy(r.targetPosition),r.orb=c,r.orb.gradualVal=3,r.orbCreated=!0,g.add(r.orb)}r.orb?(console.log("orb exists"),r.orb.position.copy(r.targetPosition),r.orb.scale.setScalar(r.orb.gradualVal),r.orb.gradualVal-=.05,r.orb.material.opacity=.3*Math.max(0,r.orb.gradualVal),r.orb.material.opacity<=.04?(g.remove(r.orb),r.orb.geometry.dispose(),r.orb.material.dispose(),r.orb=null,console.log("orb removed for recombination")):r.orb.material.opacity<=.1?(r.object.material.color.set(new o.Color(383487)),r.lerpPartner.object.material.color.set(new o.Color(16751792))):console.log("orb not removed yet")):console.log("orb does not exist"),r.lerpProgress>=.6&&Xt(r,r.lerpPartner)}}function Xt(t,e){g.remove(t.object),g.remove(e.object),u=u.filter(n=>n!==t&&n!==e),p=p.filter(n=>n!==t&&n!==e),[t,e].forEach(n=>{n.object.geometry.dispose(),n.object.material.dispose()}),Ne=!0}function Wt(){let t=new $e(o.MathUtils.randFloat(-d.x/2+1,d.x/2-1),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),e=ue(t.clone().add(new o.Vector3(2,0,0)),16724273,!1),n=ue(t.clone(),2052607,!1);e.velocity=new o.Vector3(-.02,0,0),n.velocity=new o.Vector3(.02,0,0);const i=new o.SphereGeometry(2,32,32),r=new o.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new o.Mesh(i,r);let s=e.object.position.clone().add(n.object.position.clone()).multiplyScalar(.5);a.position.copy(s),a.gradualVal=.5,g.add(a),Ve.push({hole:e,electron:n,orbSphere:a,position:t})}function Yt(){let t=6;if(Ve.length>0){let e=0;for(let n of Ve){let i=n.hole,r=n.electron,a=n.orbSphere;if(a.gradualVal<=t&&a.material.opacity>0){i.object.position.add(i.velocity),r.object.position.add(r.velocity);let s=Math.max(0,1-(a.gradualVal-1)/(t-1));a.material.opacity=s,a.gradualVal+=.1}else g.remove(a),Ve.splice(e,1),p.push({value:"h",initPos:n.position.clone().add(new o.Vector3(2,0,0)),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:i.object,material:i.material,velocity:H(),speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),u.push({value:"e",initPos:n.position.clone(),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:r.object,material:r.material,velocity:H(),speed:Math.random()*(me-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3});e++}}}function Nt(){for(let t of u)for(let e of p)if(t.initPos!=null&&e.initPos!=null){let n=t.object.position.distanceTo(t.initPos),i=e.object.position.distanceTo(e.initPos);n>tt&&i>tt&&(t.recombine=!0,e.recombine=!0)}}function Kt(t,e){let n=new $e().subVectors(t.object.position,e.object.position).length(),i=20;if(t.recombine&&e.recombine)return n<=i}function H(){let t=Oe[Math.floor(Math.random()*Oe.length)],e=Math.random()*Math.PI,n=Math.random()*(2*Math.PI);const i=t*Math.sin(e)*Math.cos(n),r=t*Math.sin(e)*Math.sin(n),a=t*Math.cos(e);return new o.Vector3(i,r,a).multiplyScalar(Rt)}function Jt(t){for(let e=0;e<u.length;e++)for(let n=0;n<p.length;n++)(t-u[e].scatterStartTime)/1e3>=u[e].scatterTime&&(u[e].velocity=H(),u[e].scatterStartTime=performance.now(),u[e].scatterTime=A+(k.noise(e*100,e*200,performance.now()*.001)-.5)*.3),(t-p[n].scatterStartTime)/1e3>=p[n].scatterTime&&(p[n].velocity=H(),p[n].scatterStartTime=performance.now(),p[n].scatterTime=A+(k.noise(n*100,n*200,performance.now()*.001)-.5)*.3)}function Qt(t,e,n,i){let r=d.y/2,a=-r,s=d.z/2,c=-s;for(let l=0;l<t.length;l++)t[l].object.position.x>=i?t[l].object.position.x=n+1:t[l].object.position.x<=n&&(t[l].object.position.x=o.MathUtils.randFloat(n+1,n+20)),t[l].object.position.y>r?(t[l].object.position.y=r-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.y<a&&(t[l].object.position.y=a+1,t[l].velocity.multiplyScalar(-1)),t[l].object.position.z>s?(t[l].object.position.z=s-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.z<c&&(t[l].object.position.z=c+1,t[l].velocity.multiplyScalar(-1));for(let l=0;l<e.length;l++)e[l].object.position.x>=i?e[l].object.position.x=o.MathUtils.randFloat(i-15,i-1):e[l].object.position.x<=n&&(e[l].object.position.x=i-1),e[l].object.position.y>r?(e[l].object.position.y=r-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.y<a&&(e[l].object.position.y=a+1,e[l].velocity.multiplyScalar(-1)),e[l].object.position.z>s?(e[l].object.position.z=s-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.z<c&&(e[l].object.position.z=c+1,e[l].velocity.multiplyScalar(-1))}function eo(){ie.__controllers.forEach(t=>t.setValue(t.initialValue))}function st(t,e,n,i){let r=3,a=.5;const s=new o.CapsuleGeometry(a,r);if(i=="acceptor"){let c=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),l=new o.Mesh(s,c);l.rotateZ(Math.PI/2),l.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),g.add(l)}else if(i=="donor"){let c=new o.CapsuleGeometry(a,r);c.rotateZ(Math.PI/2);let l=new jt.mergeGeometries([s,c]),j=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),w=new o.Mesh(l,j);w.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),g.add(w)}}function ct(t,e,n,i,r){let a=null,s,c;s=new o.SphereGeometry(1,32,32),i===16724273?c=new o.MeshBasicMaterial({color:i,wireframe:!0}):c=new o.MeshBasicMaterial({color:i,transparent:r,opacity:a});const l=new o.Mesh(s,c);return l.position.set(o.MathUtils.randFloat(e,n),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),g.add(l),{object:l,material:c}}function ue(t,e,n){let i=null,r,a;r=new o.SphereGeometry(1,32,32),e===16724273?a=new o.MeshBasicMaterial({color:e,wireframe:!0}):a=new o.MeshBasicMaterial({color:e,transparent:n,opacity:i});const s=new o.Mesh(r,a);return s.position.set(t.x,t.y,t.z),g.add(s),{object:s,material:a}}function to(t,e,n){let i=F/4;g.remove(Ie),Ie=new o.ArrowHelper(new o.Vector3(-1,0,0),t,e,n,i),g.add(Ie)}function Vt(t,e,n){t=t*.5,e=e*.5,n=n*.5;const i=new o.BufferGeometry,r=[];return r.push(-t,-e,-n,-t,e,-n,-t,e,-n,t,e,-n,t,e,-n,t,-e,-n,t,-e,-n,-t,-e,-n,-t,-e,n,-t,e,n,-t,e,n,t,e,n,t,e,n,t,-e,n,t,-e,n,-t,-e,n,-t,-e,-n,-t,-e,n,-t,e,-n,-t,e,n,t,e,-n,t,e,n,t,-e,-n,t,-e,n),i.setAttribute("position",new o.Float32BufferAttribute(r,3)),i}function oo(){U.aspect=q.clientWidth/q.clientHeight,U.updateProjectionMatrix(),P.setSize(q.clientWidth,q.clientHeight,!1),P.setPixelRatio(Math.min(window.devicePixelRatio,2))}let E,I,v,V,Y,le;const ft=document.getElementById("voltage2");let D=.22,pe=.88,Se,y=[],b=[],$=50,f=new o.Vector3(150,75,75),no=new o.Clock,ro=-(f.x/2)+1,ao=f.x/2-1,ke,C=25,dt,mt,ge,L=0,io="Voltage: "+L,de,ze;const lo=.1;let so=.5,O=2;const Z=new ht;let J=[],Q=[],Xe=[],ut=30,Ke=!1,pt=!1,yt=!1,Ce=[],re,ae,Me,Pe,R,we,Ct=20,co=60,We=f.y;const ce={leftController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1},rightController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1}},He={moveSpeed:2,rotationSpeed:.05},Ye=new Ft;fo();mo();setInterval(()=>{xo()},1e3);function fo(){const t=[{nv:.1,quantity:3},{nv:.2,quantity:10},{nv:.3,quantity:21},{nv:.4,quantity:35},{nv:.5,quantity:49},{nv:.6,quantity:63},{nv:.7,quantity:74},{nv:.8,quantity:82},{nv:.9,quantity:86},{nv:1,quantity:86},{nv:1.1,quantity:83},{nv:1.2,quantity:77},{nv:1.3,quantity:69},{nv:1.4,quantity:59},{nv:1.5,quantity:50},{nv:1.6,quantity:40},{nv:1.7,quantity:32},{nv:1.8,quantity:24},{nv:1.9,quantity:18},{nv:3,quantity:13},{nv:2.1,quantity:9},{nv:2.2,quantity:6},{nv:2.3,quantity:4},{nv:3.5,quantity:3},{nv:4,quantity:2},{nv:5,quantity:1},{nv:6,quantity:1}];for(let M=0;M<t.length;M++){let S=0;for(;S<t[M].quantity;)Xe.push(t[M].nv),S++}if(E=document.getElementById("three-container2-scene-2"),v=new o.Scene,v.background=new o.Color(1184274),I=new o.PerspectiveCamera(75,E.clientWidth/E.clientHeight,.1,1500),I.position.z=150,V=new o.WebGLRenderer,V.setSize(E.clientWidth,E.clientHeight),V.xr.enabled=!0,V.xr.setReferenceSpaceType("local-floor"),po(),E.appendChild(V.domElement),E.appendChild(St.createButton(V)),R=new o.Object3D,uo(),!E){console.error("container2 not found");return}const e=new o.AmbientLight(16777215,3);v.add(e),le=new dat.GUI,Y={translateZ:150,translateX:0,rotateY:Te.degToRad(0)},document.getElementById("myText2").innerHTML=0;const n={"Reset Cube":Vo};le.add(Y,"translateX",-100,100).onChange(()=>{I.position.x=Y.translateX}),le.add(Y,"translateZ",-50,150).onChange(()=>{I.position.z=Y.translateZ}),le.add(Y,"rotateY",-50,50).onChange(()=>{I.rotation.y=Te.degToRad(Y.rotateY)}),ft.addEventListener("input",()=>{L=parseFloat(ft.value),document.getElementById("myText2").innerHTML=L}),le.add(n,"Reset Cube"),window.addEventListener("resize",Lo),Ye.load("https://unpkg.com/three@0.163.0/examples/fonts/helvetiker_regular.typeface.json",function(M){Ye._font=M,ze=new Ge(io,{font:M,size:5,depth:.5});const S=new o.MeshBasicMaterial({color:16777215});de=new o.Mesh(ze,S),de.position.set(-20,60,0),v.add(de)});const i=new o.CurvePath,r=[new o.Vector3(-75,0,10),new o.Vector3(-120,0,10),new o.Vector3(-120,-65,10),new o.Vector3(-30,-65,10)];for(let M=0;M<r.length-1;M++){const S=new o.LineCurve3(r[M],r[M+1]);i.add(S)}const a=new o.BufferGeometry().setFromPoints(i.getPoints(50)),s=new o.LineBasicMaterial({color:16777215}),c=new o.Line(a,s);v.add(c);const l=new o.CurvePath,j=[new o.Vector3(75,0,10),new o.Vector3(120,0,10),new o.Vector3(120,-65,10),new o.Vector3(30,-65,10)];for(let M=0;M<j.length-1;M++){const S=new o.LineCurve3(j[M],j[M+1]);l.add(S)}const w=new o.BufferGeometry().setFromPoints(l.getPoints(50)),x=new o.LineBasicMaterial({color:16777215}),qe=new o.Line(w,x);v.add(qe);const Be=Tt(f.x,f.y,f.z),Ee=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});Se=new o.LineSegments(Be,Ee),Se.computeLineDistances(),Se.position.set(0,0,0);const Re=new o.CylinderGeometry(10,10,60,32),_e=new o.WireframeGeometry(Re),G=new o.LineSegments(_e);G.rotateZ(Math.PI/2),G.material.depthTest=!1,G.material.opacity=.25,G.material.transparent=!0,G.position.set(0,-70,0),v.add(G);const De=To(Ct,co,We,f.z),Ue=new o.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.4});we=new o.Mesh(De,Ue),we.position.set(0,-30,0),v.add(we);const ee=new o.PlaneGeometry(f.z,f.y),te=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});let m=new o.LineSegments(ee,te);m.computeLineDistances(),m.position.set(0,0,0),m.rotateY(Math.PI/2),v.add(Se,m);let h;for(let M=0;M<$;M++){h=X();let S=xt(M,-(f.x/2)+1,-2,16724273,!1);wt(-(f.x/2)+1,-2,16777215,"acceptor"),b.push({value:"h",initPos:S.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:S.object,material:S.material,velocity:h,speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(M*100,M*200,performance.now()*.001)-.5)*.3})}for(let M=0;M<$;M++){h=X(),wt(2,f.x/2-1,16777215,"donor");let S=xt(M,2,f.x/2-1,2052607,!1);y.push({value:"e",initPos:S.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:S.object,material:S.material,velocity:h,speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(M*100,M*200,performance.now()*.001)-.5)*.3})}}function mo(){V.setAnimationLoop(function(t,e){if(e){const c=e.session;if(c){let l={left:!1,right:!1};Array.from(c.inputSources).forEach(w=>{if(!w.gamepad)return;const x=w.handedness==="left"?ce.leftController:ce.rightController;w.gamepad.axes.length>=4&&(x.thumbstick.x=w.gamepad.axes[2]||0,x.thumbstick.y=w.gamepad.axes[3]||0,x.trigger=Math.abs(w.gamepad.buttons[0].value),x.triggerPressed=x.trigger>lo,x===ce.rightController&&x.triggerPressed&&!l.right?(L=Math.min(.4,L+.1),l.right=x.triggerPressed):x===ce.leftController&&x.triggerPressed&&!l.left&&(L=Math.max(-1.4,L-.1),l.left=x.triggerPressed),de&&(de.geometry.dispose(),ze=new Ge("Voltage: "+L.toFixed(2),{font:Ye._font,size:5,depth:.5}),de.geometry=ze))})}}let n=performance.now(),i=no.getDelta()/15;v.remove(ge),C=24.2*(.58*Math.sqrt(9.2-L*1.13/.05)),dt=Tt(C,f.y,f.z),mt=new o.LineDashedMaterial({color:16711680,dashSize:3,gapSize:1}),ge=new o.LineSegments(dt,mt),ge.computeLineDistances(),ge.position.set(0,0,0),v.add(ge);const r=new o.Vector3(C/2,0,0);if(Co(r,C,16776960),Po(n),Mt(y,C,i,-1),Mt(b,C,i,1),ho(),jo(),Mo(),L<0&&(Fe(y,"e"),Fe(b,"h")),L>0&&(Fe(y,"e"),Fe(b,"h"),Ke)){let c=new o.Vector3(f.x/2+50,0,0),l=ye(c,2052607,!1);l.value="e",J.push(l);let j=new o.Vector3(-f.x/2-50,0,0),w=ye(j,16724273,!1);w.value="h",J.push(w)}J.length>0&&go(),Q.length>0&&bo(),vo(),Fo(b,y,ro,ao),yo(),V.render(v,I)})}function bt(t){let e,n;switch(t.targetRayMode){case"tracked-pointer":return e=new o.BufferGeometry,e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new o.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new o.LineBasicMaterial({vertexColors:!0,blending:o.AdditiveBlending}),new o.Line(e,n);case"gaze":return e=new o.RingGeometry(.02,.04,32).translate(0,0,-1),n=new o.MeshBasicMaterial({opacity:.5,transparent:!0}),new o.Mesh(e,n)}}function uo(){R=new o.Object3D,R.position.set(0,0,0),R.add(I),v.add(R),re=V.xr.getController(0),ae=V.xr.getController(1),re.addEventListener("selectstart",gt),re.addEventListener("selectend",vt),re.addEventListener("connected",function(e){this.add(bt(e.data))}),re.addEventListener("disconnected",function(){this.remove(this.children[0])}),ae.addEventListener("selectstart",gt),ae.addEventListener("selectend",vt),ae.addEventListener("connected",function(e){this.add(bt(e.data))}),ae.addEventListener("disconnected",function(){this.remove(this.children[0])});const t=new Pt;Me=V.xr.getControllerGrip(0),Pe=V.xr.getControllerGrip(1),Me.add(t.createControllerModel(Me)),Pe.add(t.createControllerModel(Pe)),R.add(re),R.add(ae),R.add(Me),R.add(Pe)}async function po(t){const e=await navigator.xr.requestSession("immersive-vr"),n=e.inputSources[0];Me=e.requestReferenceSpace("local"),console.log("number of input sources:"+n.length)}function yo(){if(!V.xr.isPresenting)return;const t=ce.leftController.thumbstick,e=ce.rightController.thumbstick;Math.abs(t.y)>.1&&(R.position.z+=t.y*He.moveSpeed),Math.abs(t.x)>.1&&(R.position.x+=t.x*He.moveSpeed),Math.abs(e.x)>.1&&(R.rotation.y-=e.x*He.rotationSpeed)}function gt(){this.userData.isSelecting=!0}function vt(){this.userData.isSelecting=!1}function bo(){for(let t=Q.length-1;t>=0;t--){let e=Q[t],n=e.object.position;if(e.value=="e")if(n.x<=f.x/2)e.object.position.add(new o.Vector3(.2,0,0));else{e.object.position.add(new o.Vector3(.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x-f.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(v.remove(e.object),Q.splice(t,1))}else if(e.value=="h")if(n.x>=-f.x/2)e.object.position.add(new o.Vector3(-.2,0,0));else{e.object.position.add(new o.Vector3(-.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x+f.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(v.remove(e.object),Q.splice(t,1))}}}function go(){for(let t=J.length-1;t>=0;t--){let e=J[t],n=e.object.position;e.value=="e"?n.x<f.x/2-1?(y.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:X(),speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,$)*100,Math.random(0,$)*200,performance.now()*.001)-.5)*.3}),J.splice(t,1)):e.object.position.add(new o.Vector3(-.2,0,0)):e.value=="h"&&(n.x>-f.x/2+1?(b.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:X(),speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,$)*100,Math.random(0,$)*200,performance.now()*.001)-.5)*.3}),J.splice(t,1)):e.object.position.add(new o.Vector3(.2,0,0)))}}function Fe(t,e){let n=0,i=0;for(let r=0;r<t.length;r++){let a=t[r].object.position.x;if(L<0||L>0){if(e=="e"){if(a>C/2&&(n=n+1,n>$)){n=n-1;let s=new o.Vector3(f.x/2-5,0,0),c=ye(s,2052607,!1);c.value="e",t[r].crossed=!0,Q.push(c);let l=Math.floor(Math.random()*y.length);v.remove(y[l].object),y[l].object.geometry.dispose(),y[l].object.material.dispose(),y.splice(l,1)}}else if(e=="h"&&a<-C/2&&(i=i+1,i>$)){i=i-1;let s=new o.Vector3(-f.x/2+5,0,0),c=ye(s,16724273,!1);c.value="h",t[r].crossed=!0,Q.push(c);let l=Math.floor(Math.random()*b.length);v.remove(b[l].object),b[l].object.geometry.dispose(),b[l].object.material.dispose(),b.splice(l,1)}}if(L===0){if(e=="e"){if(a>C/2&&(n=n+1,n>$)){n=n-1;let s=Math.floor(Math.random()*y.length);v.remove(y[s].object),y[s].object.geometry.dispose(),y[s].object.material.dispose(),y.splice(s,1)}}else if(e=="h"&&a<-C/2&&(i=i+1,i>$)){i=i-1;let s=Math.floor(Math.random()*b.length);v.remove(b[s].object),b[s].object.geometry.dispose(),b[s].object.material.dispose(),b.splice(s,1)}}}}function Mt(t,e,n,i){for(let r=0;r<t.length;r++){let a=t[r].object.position.x,s=new o.Vector3(0,0,0);-e/2<a&&a<0&&(s=new o.Vector3(-1.53*(e/2+a),0,0)),0<a&&a<e/2&&(s=new o.Vector3(-1.53*(e/2-a),0,0)),(-f.x/2+1<a&&a<-e/2||e/2<a&&a<f.x/2-1||a==0)&&(s=new o.Vector3(0,0,0)),i<0?y[r].velocity.add(s.multiplyScalar(n).multiplyScalar(i)):b[r].velocity.add(s.multiplyScalar(n))}}function vo(){for(let n of[...y,...b]){const i=n.velocity.clone();i.clampLength(.9,30),n.canMove==!0&&(n.object.position.add(i),n.velocity=i)}}function Mo(){let i;for(let r=0;r<y.length;r++)for(let a=0;a<b.length;a++)!y[r]||!b[a]||(pt=y[r].object.position.x<-C/2-20||y[r].object.position.x>C/2+20,yt=b[a].object.position.x<-C/2-20||b[a].object.position.x>C/2+20,pt&&yt&&(So(y[r],b[a])?!y[r].lerping&&!b[a].lerping&&(y[r].lerping=!0,b[a].lerping=!0,y[r].lerpPartner=b[a],b[a].lerpPartner=y[r],y[r].pauseCounter=0,b[a].pauseCounter=0,y[r].lerpProgress=0,b[a].lerpProgress=0,y[r].velocity.set(0,0,0),b[a].velocity.set(0,0,0),i=new o.Vector3().addVectors(y[r].object.position,b[a].object.position).multiplyScalar(.5),y[r].targetPosition=i.clone(),b[a].targetPosition=i.clone()):Ke=!1));for(let r of[...y,...b])if(r.processed=!1,r.lerping&&!r.processed)if(r.processed=!0,console.log("lerping detected"),r.orbCreated=!1,r.pauseCounter<60)r.pauseCounter++;else{if(r.lerpProgress+=.01,r.object.position.lerp(r.targetPosition,r.lerpProgress),r.lerpProgress<=.25&&!r.orb&&!r.orbCreated){const a=new o.SphereGeometry(3,32,32),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),c=new o.Mesh(a,s);c.position.copy(r.targetPosition),r.orb=c,r.orb.gradualVal=3,r.orbCreated=!0,v.add(r.orb)}r.orb?(console.log("orb exists"),r.orb.position.copy(r.targetPosition),r.orb.scale.setScalar(r.orb.gradualVal),r.orb.gradualVal-=.05,r.orb.material.opacity=.3*Math.max(0,r.orb.gradualVal),r.orb.material.opacity<=.04?(v.remove(r.orb),r.orb.geometry.dispose(),r.orb.material.dispose(),r.orb=null,console.log("orb removed for recombination")):r.orb.material.opacity<=.1?(r.object.material.color.set(new o.Color(383487)),r.lerpPartner.object.material.color.set(new o.Color(16751792))):console.log("orb not removed yet")):console.log("orb does not exist"),r.lerpProgress>=.6&&wo(r,r.lerpPartner)}}function wo(t,e){v.remove(t.object),v.remove(e.object),y=y.filter(n=>n!==t&&n!==e),b=b.filter(n=>n!==t&&n!==e),[t,e].forEach(n=>{n.object.geometry.dispose(),n.object.material.dispose()}),Ke=!0}function xo(){let t=new $e(o.MathUtils.randFloat(-10+we.position.x,Ct/2+we.position.x),o.MathUtils.randFloat(-We/2,We/2),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1));(t.x<-f.x/2+1||t.x>f.x/2-1||t.y>f.y/2-1||t.y<-f.y/2+1)&&(t.x=o.MathUtils.clamp(t.x,-f.x/2+1,f.x/2-1),t.y=o.MathUtils.clamp(t.y,-f.x/2+1,f.x/2-1));let e=ye(t.clone().add(new o.Vector3(2,0,0)),16724273,!1),n=ye(t.clone(),2052607,!1);e.velocity=new o.Vector3(-.02,0,0),n.velocity=new o.Vector3(.02,0,0);const i=new o.SphereGeometry(2,32,32),r=new o.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new o.Mesh(i,r);let s=e.object.position.clone().add(n.object.position.clone()).multiplyScalar(.5);a.position.copy(s),a.gradualVal=.5,v.add(a),Ce.push({hole:e,electron:n,orbSphere:a,position:t})}function ho(){let t=6;if(Ce.length>0){let e=0;for(let n of Ce){let i=n.hole,r=n.electron,a=n.orbSphere;if(a.gradualVal<=t&&a.material.opacity>0){i.object.position.add(i.velocity),r.object.position.add(r.velocity);let s=Math.max(0,1-(a.gradualVal-1)/(t-1));a.material.opacity=s,a.gradualVal+=.1}else v.remove(a),Ce.splice(e,1),b.push({value:"h",initPos:n.position.clone().add(new o.Vector3(2,0,0)),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:i.object,material:i.material,velocity:X(),speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,$)*100,Math.random(0,$)*200,performance.now()*.001)-.5)*.3}),y.push({value:"e",initPos:n.position.clone(),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:r.object,material:r.material,velocity:X(),speed:Math.random()*(pe-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,$)*100,Math.random(0,$)*200,performance.now()*.001)-.5)*.3});e++}}}function jo(){for(let t of y)for(let e of b)if(t.initPos!=null&&e.initPos!=null){let n=t.object.position.distanceTo(t.initPos),i=e.object.position.distanceTo(e.initPos);n>ut&&i>ut&&(t.recombine=!0,e.recombine=!0)}}function So(t,e){let n=new $e().subVectors(t.object.position,e.object.position).length(),i=20;if(t.recombine&&e.recombine)return n<=i}function X(){let t=Xe[Math.floor(Math.random()*Xe.length)],e=Math.random()*Math.PI,n=Math.random()*(2*Math.PI);const i=t*Math.sin(e)*Math.cos(n),r=t*Math.sin(e)*Math.sin(n),a=t*Math.cos(e);return new o.Vector3(i,r,a).multiplyScalar(so)}function Po(t){for(let e=0;e<y.length;e++)for(let n=0;n<b.length;n++)(t-y[e].scatterStartTime)/1e3>=y[e].scatterTime&&(y[e].velocity=X(),y[e].scatterStartTime=performance.now(),y[e].scatterTime=O+(Z.noise(e*100,e*200,performance.now()*.001)-.5)*.3),(t-b[n].scatterStartTime)/1e3>=b[n].scatterTime&&(b[n].velocity=X(),b[n].scatterStartTime=performance.now(),b[n].scatterTime=O+(Z.noise(n*100,n*200,performance.now()*.001)-.5)*.3)}function Fo(t,e,n,i){let r=f.y/2,a=-r,s=f.z/2,c=-s;for(let l=0;l<t.length;l++)t[l].object.position.x>=i?t[l].object.position.x=n+1:t[l].object.position.x<=n&&(t[l].object.position.x=o.MathUtils.randFloat(n+1,n+20)),t[l].object.position.y>r?(t[l].object.position.y=r-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.y<a&&(t[l].object.position.y=a+1,t[l].velocity.multiplyScalar(-1)),t[l].object.position.z>s?(t[l].object.position.z=s-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.z<c&&(t[l].object.position.z=c+1,t[l].velocity.multiplyScalar(-1));for(let l=0;l<e.length;l++)e[l].object.position.x>=i?e[l].object.position.x=o.MathUtils.randFloat(i-15,i-1):e[l].object.position.x<=n&&(e[l].object.position.x=i-1),e[l].object.position.y>r?(e[l].object.position.y=r-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.y<a&&(e[l].object.position.y=a+1,e[l].velocity.multiplyScalar(-1)),e[l].object.position.z>s?(e[l].object.position.z=s-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.z<c&&(e[l].object.position.z=c+1,e[l].velocity.multiplyScalar(-1))}function Vo(){le.__controllers.forEach(t=>t.setValue(t.initialValue))}function wt(t,e,n,i){let r=3,a=.5;const s=new o.CapsuleGeometry(a,r);if(i=="acceptor"){let c=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),l=new o.Mesh(s,c);l.rotateZ(Math.PI/2),l.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),v.add(l)}else if(i=="donor"){let c=new o.CapsuleGeometry(a,r);c.rotateZ(Math.PI/2);let l=new jt.mergeGeometries([s,c]),j=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),w=new o.Mesh(l,j);w.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),v.add(w)}}function xt(t,e,n,i,r){let a=null,s,c;s=new o.SphereGeometry(1,32,32),i===16724273?c=new o.MeshBasicMaterial({color:i,wireframe:!0}):c=new o.MeshBasicMaterial({color:i,transparent:r,opacity:a});const l=new o.Mesh(s,c);return l.position.set(o.MathUtils.randFloat(e,n),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),v.add(l),{object:l,material:c}}function ye(t,e,n){let i=null,r,a;r=new o.SphereGeometry(1,32,32),e===16724273?a=new o.MeshBasicMaterial({color:e,wireframe:!0}):a=new o.MeshBasicMaterial({color:e,transparent:n,opacity:i});const s=new o.Mesh(r,a);return s.position.set(t.x,t.y,t.z),v.add(s),{object:s,material:a}}function Co(t,e,n){let i=C/4;v.remove(ke),ke=new o.ArrowHelper(new o.Vector3(-1,0,0),t,e,n,i),v.add(ke)}function To(t,e,n,i){const r=new o.BufferGeometry,a=[-20/2,n,-i/2,t/2,n,-i/2,t/2,n,i/2,-20/2,n,i/2,-60/2,0,-i/2,e/2,0,-i/2,e/2,0,i/2,-60/2,0,i/2,-20/2,n,-i/2,-60/2,0,-i/2,-60/2,0,i/2,-20/2,n,i/2,t/2,n,-i/2,e/2,0,-i/2,e/2,0,i/2,t/2,n,i/2],s=[0,1,2,2,3,0,4,5,6,6,7,4,3,2,6,6,7,3,1,5,6,6,2,1,0,3,7,7,4,0,5,1,0,0,4,5];return r.setIndex(s),r.setAttribute("position",new o.BufferAttribute(new Float32Array(a),3)),r.computeVertexNormals(),r}function Tt(t,e,n){t=t*.5,e=e*.5,n=n*.5;const i=new o.BufferGeometry,r=[];return r.push(-t,-e,-n,-t,e,-n,-t,e,-n,t,e,-n,t,e,-n,t,-e,-n,t,-e,-n,-t,-e,-n,-t,-e,n,-t,e,n,-t,e,n,t,e,n,t,e,n,t,-e,n,t,-e,n,-t,-e,n,-t,-e,-n,-t,-e,n,-t,e,-n,-t,e,n,t,e,-n,t,e,n,t,-e,-n,t,-e,n),i.setAttribute("position",new o.Float32BufferAttribute(r,3)),i}function Lo(){I.aspect=E.clientWidth/E.clientHeight,I.updateProjectionMatrix(),V.setSize(E.clientWidth,E.clientHeight,!1),V.setPixelRatio(Math.min(window.devicePixelRatio,2))}
