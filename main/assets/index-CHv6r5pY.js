import*as o from"https://unpkg.com/three@0.163.0/build/three.module.js";import{MathUtils as Ce}from"https://unpkg.com/three@0.163.0/src/math/MathUtils.js";import{ImprovedNoise as vt}from"https://unpkg.com/three@0.163.0/examples/jsm/math/ImprovedNoise.js";import*as Mt from"https://unpkg.com/three@0.163.0/examples/jsm/utils/BufferGeometryUtils.js";import{Vector3 as Te}from"https://unpkg.com/three@0.163.0/src/math/Vector3.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/TransformControls.js";import"https://unpkg.com/three@0.163.0/examples/jsm/controls/OrbitControls.js";import{XRButton as wt}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRButton.js";import{XRControllerModelFactory as xt}from"https://unpkg.com/three@0.163.0/examples/jsm/webxr/XRControllerModelFactory.js";import{TextGeometry as ht}from"https://unpkg.com/three@0.163.0/examples/jsm/geometries/TextGeometry.js";import{FontLoader as jt}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/FontLoader.js";import{RGBELoader as Vt}from"https://unpkg.com/three@0.163.0/examples/jsm/loaders/RGBELoader.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const Ct="/assets/moonless_golf_1k.hdr";let $,U,M,P,W,ie;const We=document.getElementById("voltage");let _=.22,de=.88,we,m=[],u=[],T=50,d=new o.Vector3(150,75,75),Lt=new o.Clock;d.y;let Tt=-(d.x/2)+1,zt=d.x/2-1,_e,F=25,Ye,Ne,ye,R=0;const Gt=.1;let $t=.5,A=2;const k=new vt;let N=[],K=[],Ae=[],Ke=30,Ze=!1,Je=!1,Qe=!1,Fe=[],oe,ne,ge,xe,q;const se={leftController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1},rightController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1}},De={moveSpeed:2,rotationSpeed:.05};new jt;qt();Bt();setInterval(()=>{Ht()},2e3);function qt(){const t=[{nv:.1,quantity:3},{nv:.2,quantity:10},{nv:.3,quantity:21},{nv:.4,quantity:35},{nv:.5,quantity:49},{nv:.6,quantity:63},{nv:.7,quantity:74},{nv:.8,quantity:82},{nv:.9,quantity:86},{nv:1,quantity:86},{nv:1.1,quantity:83},{nv:1.2,quantity:77},{nv:1.3,quantity:69},{nv:1.4,quantity:59},{nv:1.5,quantity:50},{nv:1.6,quantity:40},{nv:1.7,quantity:32},{nv:1.8,quantity:24},{nv:1.9,quantity:18},{nv:3,quantity:13},{nv:2.1,quantity:9},{nv:2.2,quantity:6},{nv:2.3,quantity:4},{nv:3.5,quantity:3},{nv:4,quantity:2},{nv:5,quantity:1},{nv:6,quantity:1}];for(let b=0;b<t.length;b++){let h=0;for(;h<t[b].quantity;)Ae.push(t[b].nv),h++}if($=document.getElementById("three-container-scene-1"),M=new o.Scene,new Vt().load(Ct,function(b){b.mapping=o.EquirectangularReflectionMapping,b.format=o.RGBAFormat,b.minFilter=o.LinearFilter,b.magFilter=o.LinearFilter,b.generateMipmaps=!1,M.environment=b,M.background=b}),U=new o.PerspectiveCamera(75,$.clientWidth/$.clientHeight,.1,1500),U.position.z=150,P=new o.WebGLRenderer({alpha:!1}),P.setSize($.clientWidth,$.clientHeight),P.xr.enabled=!0,P.xr.setReferenceSpaceType("local-floor"),Rt(),$.appendChild(P.domElement),$.appendChild(wt.createButton(P)),q=new o.Object3D,Et(),!$){console.error("Container not found");return}const e=new o.AmbientLight(16777215,3);M.add(e),ie=new dat.GUI,W={translateZ:150,translateX:0,rotateY:Ce.degToRad(0)},document.getElementById("myText").innerHTML=0,ie.add(W,"translateX",-100,100).onChange(()=>{U.position.x=W.translateX}),ie.add(W,"translateZ",-50,150).onChange(()=>{U.position.z=W.translateZ}),ie.add(W,"rotateY",-50,50).onChange(()=>{U.rotation.y=Ce.degToRad(W.rotateY)});const n={"Reset Cube":Nt};ie.add(n,"Reset Cube"),We.addEventListener("input",()=>{R=parseFloat(We.value),document.getElementById("myText").innerHTML=R}),window.addEventListener("resize",Jt);const i=new o.CurvePath,r=[new o.Vector3(-75,0,10),new o.Vector3(-120,0,10),new o.Vector3(-120,-65,10),new o.Vector3(-30,-65,10)];for(let b=0;b<r.length-1;b++){const h=new o.LineCurve3(r[b],r[b+1]);i.add(h)}const a=new o.BufferGeometry().setFromPoints(i.getPoints(50)),s=new o.LineBasicMaterial({color:16777215}),c=new o.Line(a,s);M.add(c);const l=new o.CurvePath,j=[new o.Vector3(75,0,10),new o.Vector3(120,0,10),new o.Vector3(120,-65,10),new o.Vector3(30,-65,10)];for(let b=0;b<j.length-1;b++){const h=new o.LineCurve3(j[b],j[b+1]);l.add(h)}const w=new o.BufferGeometry().setFromPoints(l.getPoints(50)),x=new o.LineBasicMaterial({color:16777215}),ze=new o.Line(w,x);M.add(ze);const Ge=St(d.x,d.y,d.z),$e=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});we=new o.LineSegments(Ge,$e),we.computeLineDistances(),we.position.set(0,0,0);const qe=new o.CylinderGeometry(10,10,60,32),Be=new o.WireframeGeometry(qe),G=new o.LineSegments(Be);G.rotateZ(Math.PI/2),G.material.depthTest=!1,G.material.opacity=.25,G.material.transparent=!0,G.position.set(0,-70,0),M.add(G);const Ee=new o.PlaneGeometry(d.z,d.y),Re=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});let ee=new o.LineSegments(Ee,Re);ee.computeLineDistances(),ee.position.set(0,0,0),ee.rotateY(Math.PI/2),M.add(we,ee);let te;for(let b=0;b<T;b++){te=H();let h=at(b,-(d.x/2)+1,-2,16724273,!1);rt(-(d.x/2)+1,-2,16777215,"acceptor"),u.push({value:"h",initPos:h.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:h.object,material:h.material,velocity:te,speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(b*100,b*200,performance.now()*.001)-.5)*.3})}for(let b=0;b<T;b++){te=H(),rt(2,d.x/2-1,16777215,"donor");let h=at(b,2,d.x/2-1,2052607,!1);m.push({value:"e",initPos:h.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:h.object,material:h.material,velocity:te,speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(b*100,b*200,performance.now()*.001)-.5)*.3})}}function Bt(){P.setAnimationLoop(function(t,e){if(e){const c=e.session;if(c){let l={left:!1,right:!1};Array.from(c.inputSources).forEach(w=>{if(!w.gamepad)return;const x=w.handedness==="left"?se.leftController:se.rightController;w.gamepad.axes.length>=4&&(x.thumbstick.x=w.gamepad.axes[2]||0,x.thumbstick.y=w.gamepad.axes[3]||0,x.trigger=Math.abs(w.gamepad.buttons[0].value),x.triggerPressed=x.trigger>Gt,x===se.rightController&&x.triggerPressed&&!l.right?(R=Math.min(.4,R+.1),l.right=x.triggerPressed):x===se.leftController&&x.triggerPressed&&!l.left&&(R=Math.max(-1.4,R-.1),l.left=x.triggerPressed))})}}let n=performance.now(),i=Lt.getDelta()/15;M.remove(ye),F=24.2*(.58*Math.sqrt(9.2-R*1.13/.05)),Ye=St(F,d.y,d.z),Ne=new o.LineDashedMaterial({color:16711680,dashSize:3,gapSize:1}),ye=new o.LineSegments(Ye,Ne),ye.computeLineDistances(),ye.position.set(0,0,0),M.add(ye);let r=new o.Vector3(F/2,0,0);if(Kt(r,F,16776960),Wt(n),nt(m,F,i,-1),nt(u,F,i,1),Ot(),Zt(),At(),R<0&&(he(m,"e"),he(u,"h")),R>0&&(he(m,"e"),he(u,"h"),Ze)){let c=new o.Vector3(d.x/2+50,0,0),l=me(c,2052607,!1);l.value="e",N.push(l);let j=new o.Vector3(-d.x/2-50,0,0),w=me(j,16724273,!1);w.value="h",N.push(w)}N.length>0&&Ut(),K.length>0&&Dt(),It(),Yt(u,m,Tt,zt),_t(),P.render(M,U)})}function et(t){let e,n;switch(t.targetRayMode){case"tracked-pointer":return e=new o.BufferGeometry,e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new o.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new o.LineBasicMaterial({vertexColors:!0,blending:o.AdditiveBlending}),new o.Line(e,n);case"gaze":return e=new o.RingGeometry(.02,.04,32).translate(0,0,-1),n=new o.MeshBasicMaterial({opacity:.5,transparent:!0}),new o.Mesh(e,n)}}function Et(){q=new o.Object3D,q.position.set(0,0,0),q.add(U),M.add(q),oe=P.xr.getController(0),ne=P.xr.getController(1),oe.addEventListener("selectstart",tt),oe.addEventListener("selectend",ot),oe.addEventListener("connected",function(e){this.add(et(e.data))}),oe.addEventListener("disconnected",function(){this.remove(this.children[0])}),ne.addEventListener("selectstart",tt),ne.addEventListener("selectend",ot),ne.addEventListener("connected",function(e){this.add(et(e.data))}),ne.addEventListener("disconnected",function(){this.remove(this.children[0])});const t=new xt;ge=P.xr.getControllerGrip(0),xe=P.xr.getControllerGrip(1),ge.add(t.createControllerModel(ge)),xe.add(t.createControllerModel(xe)),q.add(oe),q.add(ne),q.add(ge),q.add(xe)}async function Rt(t){const e=await navigator.xr.requestSession("immersive-vr"),n=e.inputSources[0];ge=e.requestReferenceSpace("local"),console.log("number of input sources:"+n.length)}function _t(){if(!P.xr.isPresenting)return;const t=se.leftController.thumbstick,e=se.rightController.thumbstick;Math.abs(t.y)>.1&&(q.position.z+=t.y*De.moveSpeed),Math.abs(t.x)>.1&&(q.position.x+=t.x*De.moveSpeed),Math.abs(e.x)>.1&&(q.rotation.y-=e.x*De.rotationSpeed)}function tt(){this.userData.isSelecting=!0}function ot(){this.userData.isSelecting=!1}function Dt(){for(let t=K.length-1;t>=0;t--){let e=K[t],n=e.object.position;if(e.value=="e")if(n.x<=d.x/2)e.object.position.add(new o.Vector3(.2,0,0));else{e.object.position.add(new o.Vector3(.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x-d.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(M.remove(e.object),K.splice(t,1))}else if(e.value=="h")if(n.x>=-d.x/2)e.object.position.add(new o.Vector3(-.2,0,0));else{e.object.position.add(new o.Vector3(-.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x+d.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(M.remove(e.object),K.splice(t,1))}}}function Ut(){for(let t=N.length-1;t>=0;t--){let e=N[t],n=e.object.position;e.value=="e"?n.x<d.x/2-1?(m.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:H(),speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,T)*100,Math.random(0,T)*200,performance.now()*.001)-.5)*.3}),N.splice(t,1)):e.object.position.add(new o.Vector3(-.2,0,0)):e.value=="h"&&(n.x>-d.x/2+1?(u.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:H(),speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,T)*100,Math.random(0,T)*200,performance.now()*.001)-.5)*.3}),N.splice(t,1)):e.object.position.add(new o.Vector3(.2,0,0)))}}function he(t,e){let n=0,i=0;for(let r=0;r<t.length;r++){let a=t[r].object.position.x;if(R<0||R>0){if(e=="e"){if(a>F/2&&(n=n+1,n>T)){n=n-1;let s=new o.Vector3(d.x/2-5,0,0),c=me(s,2052607,!1);c.value="e",t[r].crossed=!0,K.push(c);let l=Math.floor(Math.random()*m.length);M.remove(m[l].object),m[l].object.geometry.dispose(),m[l].object.material.dispose(),m.splice(l,1)}}else if(e=="h"&&a<-F/2&&(i=i+1,i>T)){i=i-1;let s=new o.Vector3(-d.x/2+5,0,0),c=me(s,16724273,!1);c.value="h",t[r].crossed=!0,K.push(c);let l=Math.floor(Math.random()*u.length);M.remove(u[l].object),u[l].object.geometry.dispose(),u[l].object.material.dispose(),u.splice(l,1)}}if(R===0){if(e=="e"){if(a>F/2&&(n=n+1,n>T)){n=n-1;let s=Math.floor(Math.random()*m.length);M.remove(m[s].object),m[s].object.geometry.dispose(),m[s].object.material.dispose(),m.splice(s,1)}}else if(e=="h"&&a<-F/2&&(i=i+1,i>T)){i=i-1;let s=Math.floor(Math.random()*u.length);M.remove(u[s].object),u[s].object.geometry.dispose(),u[s].object.material.dispose(),u.splice(s,1)}}}}function nt(t,e,n,i){for(let r=0;r<t.length;r++){let a=t[r].object.position.x,s=new o.Vector3(0,0,0);-e/2<a&&a<0&&(s=new o.Vector3(-1.53*(e/2+a),0,0)),0<a&&a<e/2&&(s=new o.Vector3(-1.53*(e/2-a),0,0)),(-d.x/2+1<a&&a<-e/2||e/2<a&&a<d.x/2-1||a==0)&&(s=new o.Vector3(0,0,0)),i<0?m[r].velocity.add(s.multiplyScalar(n).multiplyScalar(i)):u[r].velocity.add(s.multiplyScalar(n))}}function It(){for(let n of[...m,...u]){const i=n.velocity.clone();i.clampLength(.9,30),n.canMove==!0&&(n.object.position.add(i),n.velocity=i)}}function At(){let i;for(let r=0;r<m.length;r++)for(let a=0;a<u.length;a++)!m[r]||!u[a]||(Je=m[r].object.position.x<-F/2-20||m[r].object.position.x>F/2+20,Qe=u[a].object.position.x<-F/2-20||u[a].object.position.x>F/2+20,Je&&Qe&&(Xt(m[r],u[a])?!m[r].lerping&&!u[a].lerping&&(m[r].lerping=!0,u[a].lerping=!0,m[r].lerpPartner=u[a],u[a].lerpPartner=m[r],m[r].pauseCounter=0,u[a].pauseCounter=0,m[r].lerpProgress=0,u[a].lerpProgress=0,m[r].velocity.set(0,0,0),u[a].velocity.set(0,0,0),i=new o.Vector3().addVectors(m[r].object.position,u[a].object.position).multiplyScalar(.5),m[r].targetPosition=i.clone(),u[a].targetPosition=i.clone()):Ze=!1));for(let r of[...m,...u])if(r.processed=!1,r.lerping&&!r.processed)if(r.processed=!0,console.log("lerping detected"),r.orbCreated=!1,r.pauseCounter<60)r.pauseCounter++;else{if(r.lerpProgress+=.01,r.object.position.lerp(r.targetPosition,r.lerpProgress),r.lerpProgress<=.25&&!r.orb&&!r.orbCreated){const a=new o.SphereGeometry(3,32,32),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),c=new o.Mesh(a,s);c.position.copy(r.targetPosition),r.orb=c,r.orb.gradualVal=3,r.orbCreated=!0,M.add(r.orb)}r.orb?(console.log("orb exists"),r.orb.position.copy(r.targetPosition),r.orb.scale.setScalar(r.orb.gradualVal),r.orb.gradualVal-=.05,r.orb.material.opacity=.3*Math.max(0,r.orb.gradualVal),r.orb.material.opacity<=.04?(M.remove(r.orb),r.orb.geometry.dispose(),r.orb.material.dispose(),r.orb=null,console.log("orb removed for recombination")):r.orb.material.opacity<=.1?(r.object.material.color.set(new o.Color(383487)),r.lerpPartner.object.material.color.set(new o.Color(16751792))):console.log("orb not removed yet")):console.log("orb does not exist"),r.lerpProgress>=.6&&kt(r,r.lerpPartner)}}function kt(t,e){M.remove(t.object),M.remove(e.object),m=m.filter(n=>n!==t&&n!==e),u=u.filter(n=>n!==t&&n!==e),[t,e].forEach(n=>{n.object.geometry.dispose(),n.object.material.dispose()}),Ze=!0}function Ht(){let t=new Te(o.MathUtils.randFloat(-d.x/2+1,d.x/2-1),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),e=me(t.clone().add(new o.Vector3(2,0,0)),16724273,!1),n=me(t.clone(),2052607,!1);e.velocity=new o.Vector3(-.02,0,0),n.velocity=new o.Vector3(.02,0,0);const i=new o.SphereGeometry(2,32,32),r=new o.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new o.Mesh(i,r);let s=e.object.position.clone().add(n.object.position.clone()).multiplyScalar(.5);a.position.copy(s),a.gradualVal=.5,M.add(a),Fe.push({hole:e,electron:n,orbSphere:a,position:t})}function Ot(){let t=6;if(Fe.length>0){let e=0;for(let n of Fe){let i=n.hole,r=n.electron,a=n.orbSphere;if(a.gradualVal<=t&&a.material.opacity>0){i.object.position.add(i.velocity),r.object.position.add(r.velocity);let s=Math.max(0,1-(a.gradualVal-1)/(t-1));a.material.opacity=s,a.gradualVal+=.1}else M.remove(a),Fe.splice(e,1),u.push({value:"h",initPos:n.position.clone().add(new o.Vector3(2,0,0)),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:i.object,material:i.material,velocity:H(),speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,T)*100,Math.random(0,T)*200,performance.now()*.001)-.5)*.3}),m.push({value:"e",initPos:n.position.clone(),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:r.object,material:r.material,velocity:H(),speed:Math.random()*(de-_+1)+_,scatterStartTime:performance.now(),scatterTime:A+(k.noise(Math.random(0,T)*100,Math.random(0,T)*200,performance.now()*.001)-.5)*.3});e++}}}function Zt(){for(let t of m)for(let e of u)if(t.initPos!=null&&e.initPos!=null){let n=t.object.position.distanceTo(t.initPos),i=e.object.position.distanceTo(e.initPos);n>Ke&&i>Ke&&(t.recombine=!0,e.recombine=!0)}}function Xt(t,e){let n=new Te().subVectors(t.object.position,e.object.position).length(),i=20;if(t.recombine&&e.recombine)return n<=i}function H(){let t=Ae[Math.floor(Math.random()*Ae.length)],e=Math.random()*Math.PI,n=Math.random()*(2*Math.PI);const i=t*Math.sin(e)*Math.cos(n),r=t*Math.sin(e)*Math.sin(n),a=t*Math.cos(e);return new o.Vector3(i,r,a).multiplyScalar($t)}function Wt(t){for(let e=0;e<m.length;e++)for(let n=0;n<u.length;n++)(t-m[e].scatterStartTime)/1e3>=m[e].scatterTime&&(m[e].velocity=H(),m[e].scatterStartTime=performance.now(),m[e].scatterTime=A+(k.noise(e*100,e*200,performance.now()*.001)-.5)*.3),(t-u[n].scatterStartTime)/1e3>=u[n].scatterTime&&(u[n].velocity=H(),u[n].scatterStartTime=performance.now(),u[n].scatterTime=A+(k.noise(n*100,n*200,performance.now()*.001)-.5)*.3)}function Yt(t,e,n,i){let r=d.y/2,a=-r,s=d.z/2,c=-s;for(let l=0;l<t.length;l++)t[l].object.position.x>=i?t[l].object.position.x=n+1:t[l].object.position.x<=n&&(t[l].object.position.x=o.MathUtils.randFloat(n+1,n+20)),t[l].object.position.y>r?(t[l].object.position.y=r-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.y<a&&(t[l].object.position.y=a+1,t[l].velocity.multiplyScalar(-1)),t[l].object.position.z>s?(t[l].object.position.z=s-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.z<c&&(t[l].object.position.z=c+1,t[l].velocity.multiplyScalar(-1));for(let l=0;l<e.length;l++)e[l].object.position.x>=i?e[l].object.position.x=o.MathUtils.randFloat(i-15,i-1):e[l].object.position.x<=n&&(e[l].object.position.x=i-1),e[l].object.position.y>r?(e[l].object.position.y=r-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.y<a&&(e[l].object.position.y=a+1,e[l].velocity.multiplyScalar(-1)),e[l].object.position.z>s?(e[l].object.position.z=s-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.z<c&&(e[l].object.position.z=c+1,e[l].velocity.multiplyScalar(-1))}function Nt(){ie.__controllers.forEach(t=>t.setValue(t.initialValue))}function rt(t,e,n,i){let r=3,a=.5;const s=new o.CapsuleGeometry(a,r);if(i=="acceptor"){let c=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),l=new o.Mesh(s,c);l.rotateZ(Math.PI/2),l.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),M.add(l)}else if(i=="donor"){let c=new o.CapsuleGeometry(a,r);c.rotateZ(Math.PI/2);let l=new Mt.mergeGeometries([s,c]),j=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),w=new o.Mesh(l,j);w.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),M.add(w)}}function at(t,e,n,i,r){let a=null,s,c;s=new o.SphereGeometry(1,32,32),i===16724273?c=new o.MeshBasicMaterial({color:i,wireframe:!0}):c=new o.MeshBasicMaterial({color:i,transparent:r,opacity:a});const l=new o.Mesh(s,c);return l.position.set(o.MathUtils.randFloat(e,n),o.MathUtils.randFloat(-d.y/2+1,d.y/2-1),o.MathUtils.randFloat(-d.z/2+1,d.z/2-1)),M.add(l),{object:l,material:c}}function me(t,e,n){let i=null,r,a;r=new o.SphereGeometry(1,32,32),e===16724273?a=new o.MeshBasicMaterial({color:e,wireframe:!0}):a=new o.MeshBasicMaterial({color:e,transparent:n,opacity:i});const s=new o.Mesh(r,a);return s.position.set(t.x,t.y,t.z),M.add(s),{object:s,material:a}}function Kt(t,e,n){let i=F/4;M.remove(_e),_e=new o.ArrowHelper(new o.Vector3(-1,0,0),t,e,n,i),M.add(_e)}function St(t,e,n){t=t*.5,e=e*.5,n=n*.5;const i=new o.BufferGeometry,r=[];return r.push(-t,-e,-n,-t,e,-n,-t,e,-n,t,e,-n,t,e,-n,t,-e,-n,t,-e,-n,-t,-e,-n,-t,-e,n,-t,e,n,-t,e,n,t,e,n,t,e,n,t,-e,n,t,-e,n,-t,-e,n,-t,-e,-n,-t,-e,n,-t,e,-n,-t,e,n,t,e,-n,t,e,n,t,-e,-n,t,-e,n),i.setAttribute("position",new o.Float32BufferAttribute(r,3)),i}function Jt(){U.aspect=$.clientWidth/$.clientHeight,U.updateProjectionMatrix(),P.setSize($.clientWidth,$.clientHeight,!1),P.setPixelRatio(Math.min(window.devicePixelRatio,2))}let B,I,g,V,Y,le;const it=document.getElementById("voltage2");let D=.22,ue=.88,je,p=[],y=[],z=50,f=new o.Vector3(150,75,75),Qt=new o.Clock,eo=-(f.x/2)+1,to=f.x/2-1,Ue,C=25,lt,st,be,L=0,oo="Voltage: "+L,fe,Le;const no=.1;let ro=.5,O=2;const Z=new vt;let J=[],Q=[],ke=[],ct=30,Xe=!1,ft=!1,dt=!1,Ve=[],re,ae,ve,Se,E,Me,Pt=20,ao=60,He=f.y;const ce={leftController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1},rightController:{thumbstick:{x:0,y:0},trigger:0,triggerPressed:!1}},Ie={moveSpeed:2,rotationSpeed:.05},Oe=new jt;io();lo();setInterval(()=>{go()},1e3);function io(){const t=[{nv:.1,quantity:3},{nv:.2,quantity:10},{nv:.3,quantity:21},{nv:.4,quantity:35},{nv:.5,quantity:49},{nv:.6,quantity:63},{nv:.7,quantity:74},{nv:.8,quantity:82},{nv:.9,quantity:86},{nv:1,quantity:86},{nv:1.1,quantity:83},{nv:1.2,quantity:77},{nv:1.3,quantity:69},{nv:1.4,quantity:59},{nv:1.5,quantity:50},{nv:1.6,quantity:40},{nv:1.7,quantity:32},{nv:1.8,quantity:24},{nv:1.9,quantity:18},{nv:3,quantity:13},{nv:2.1,quantity:9},{nv:2.2,quantity:6},{nv:2.3,quantity:4},{nv:3.5,quantity:3},{nv:4,quantity:2},{nv:5,quantity:1},{nv:6,quantity:1}];for(let v=0;v<t.length;v++){let S=0;for(;S<t[v].quantity;)ke.push(t[v].nv),S++}if(B=document.getElementById("three-container2-scene-2"),g=new o.Scene,g.background=new o.Color(1184274),I=new o.PerspectiveCamera(75,B.clientWidth/B.clientHeight,.1,1500),I.position.z=150,V=new o.WebGLRenderer,V.setSize(B.clientWidth,B.clientHeight),V.xr.enabled=!0,V.xr.setReferenceSpaceType("local-floor"),co(),B.appendChild(V.domElement),B.appendChild(wt.createButton(V)),E=new o.Object3D,so(),!B){console.error("container2 not found");return}const e=new o.AmbientLight(16777215,3);g.add(e),le=new dat.GUI,Y={translateZ:150,translateX:0,rotateY:Ce.degToRad(0)},document.getElementById("myText2").innerHTML=0;const n={"Reset Cube":jo};le.add(Y,"translateX",-100,100).onChange(()=>{I.position.x=Y.translateX}),le.add(Y,"translateZ",-50,150).onChange(()=>{I.position.z=Y.translateZ}),le.add(Y,"rotateY",-50,50).onChange(()=>{I.rotation.y=Ce.degToRad(Y.rotateY)}),it.addEventListener("input",()=>{L=parseFloat(it.value),document.getElementById("myText2").innerHTML=L}),le.add(n,"Reset Cube"),window.addEventListener("resize",Fo),Oe.load("https://unpkg.com/three@0.163.0/examples/fonts/helvetiker_regular.typeface.json",function(v){Oe._font=v,Le=new ht(oo,{font:v,size:5,depth:.5});const S=new o.MeshBasicMaterial({color:16777215});fe=new o.Mesh(Le,S),fe.position.set(-20,60,0),g.add(fe)});const i=new o.CurvePath,r=[new o.Vector3(-75,0,10),new o.Vector3(-120,0,10),new o.Vector3(-120,-65,10),new o.Vector3(-30,-65,10)];for(let v=0;v<r.length-1;v++){const S=new o.LineCurve3(r[v],r[v+1]);i.add(S)}const a=new o.BufferGeometry().setFromPoints(i.getPoints(50)),s=new o.LineBasicMaterial({color:16777215}),c=new o.Line(a,s);g.add(c);const l=new o.CurvePath,j=[new o.Vector3(75,0,10),new o.Vector3(120,0,10),new o.Vector3(120,-65,10),new o.Vector3(30,-65,10)];for(let v=0;v<j.length-1;v++){const S=new o.LineCurve3(j[v],j[v+1]);l.add(S)}const w=new o.BufferGeometry().setFromPoints(l.getPoints(50)),x=new o.LineBasicMaterial({color:16777215}),ze=new o.Line(w,x);g.add(ze);const Ge=Ft(f.x,f.y,f.z),$e=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});je=new o.LineSegments(Ge,$e),je.computeLineDistances(),je.position.set(0,0,0);const qe=new o.CylinderGeometry(10,10,60,32),Be=new o.WireframeGeometry(qe),G=new o.LineSegments(Be);G.rotateZ(Math.PI/2),G.material.depthTest=!1,G.material.opacity=.25,G.material.transparent=!0,G.position.set(0,-70,0),g.add(G);const Ee=Po(Pt,ao,He,f.z),Re=new o.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.4});Me=new o.Mesh(Ee,Re),Me.position.set(0,-30,0),g.add(Me);const ee=new o.PlaneGeometry(f.z,f.y),te=new o.LineDashedMaterial({color:16777215,dashSize:3,gapSize:1});let b=new o.LineSegments(ee,te);b.computeLineDistances(),b.position.set(0,0,0),b.rotateY(Math.PI/2),g.add(je,b);let h;for(let v=0;v<z;v++){h=X();let S=gt(v,-(f.x/2)+1,-2,16724273,!1);bt(-(f.x/2)+1,-2,16777215,"acceptor"),y.push({value:"h",initPos:S.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:S.object,material:S.material,velocity:h,speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(v*100,v*200,performance.now()*.001)-.5)*.3})}for(let v=0;v<z;v++){h=X(),bt(2,f.x/2-1,16777215,"donor");let S=gt(v,2,f.x/2-1,2052607,!1);p.push({value:"e",initPos:S.object.position,crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,canMove:!0,id:"normal",object:S.object,material:S.material,velocity:h,speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(v*100,v*200,performance.now()*.001)-.5)*.3})}}function lo(){V.setAnimationLoop(function(t,e){if(e){const c=e.session;if(c){let l={left:!1,right:!1};Array.from(c.inputSources).forEach(w=>{if(!w.gamepad)return;const x=w.handedness==="left"?ce.leftController:ce.rightController;w.gamepad.axes.length>=4&&(x.thumbstick.x=w.gamepad.axes[2]||0,x.thumbstick.y=w.gamepad.axes[3]||0,x.trigger=Math.abs(w.gamepad.buttons[0].value),x.triggerPressed=x.trigger>no,x===ce.rightController&&x.triggerPressed&&!l.right?(L=Math.min(.4,L+.1),l.right=x.triggerPressed):x===ce.leftController&&x.triggerPressed&&!l.left&&(L=Math.max(-1.4,L-.1),l.left=x.triggerPressed),fe&&(fe.geometry.dispose(),Le=new ht("Voltage: "+L.toFixed(2),{font:Oe._font,size:5,depth:.5}),fe.geometry=Le))})}}let n=performance.now(),i=Qt.getDelta()/15;g.remove(be),C=24.2*(.58*Math.sqrt(9.2-L*1.13/.05)),lt=Ft(C,f.y,f.z),st=new o.LineDashedMaterial({color:16711680,dashSize:3,gapSize:1}),be=new o.LineSegments(lt,st),be.computeLineDistances(),be.position.set(0,0,0),g.add(be);const r=new o.Vector3(C/2,0,0);if(So(r,C,16776960),xo(n),yt(p,C,i,-1),yt(y,C,i,1),vo(),Mo(),yo(),L<0&&(Pe(p,"e"),Pe(y,"h")),L>0&&(Pe(p,"e"),Pe(y,"h"),Xe)){let c=new o.Vector3(f.x/2+50,0,0),l=pe(c,2052607,!1);l.value="e",J.push(l);let j=new o.Vector3(-f.x/2-50,0,0),w=pe(j,16724273,!1);w.value="h",J.push(w)}J.length>0&&uo(),Q.length>0&&mo(),po(),ho(y,p,eo,to),fo(),V.render(g,I)})}function mt(t){let e,n;switch(t.targetRayMode){case"tracked-pointer":return e=new o.BufferGeometry,e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new o.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new o.LineBasicMaterial({vertexColors:!0,blending:o.AdditiveBlending}),new o.Line(e,n);case"gaze":return e=new o.RingGeometry(.02,.04,32).translate(0,0,-1),n=new o.MeshBasicMaterial({opacity:.5,transparent:!0}),new o.Mesh(e,n)}}function so(){E=new o.Object3D,E.position.set(0,0,0),E.add(I),g.add(E),re=V.xr.getController(0),ae=V.xr.getController(1),re.addEventListener("selectstart",ut),re.addEventListener("selectend",pt),re.addEventListener("connected",function(e){this.add(mt(e.data))}),re.addEventListener("disconnected",function(){this.remove(this.children[0])}),ae.addEventListener("selectstart",ut),ae.addEventListener("selectend",pt),ae.addEventListener("connected",function(e){this.add(mt(e.data))}),ae.addEventListener("disconnected",function(){this.remove(this.children[0])});const t=new xt;ve=V.xr.getControllerGrip(0),Se=V.xr.getControllerGrip(1),ve.add(t.createControllerModel(ve)),Se.add(t.createControllerModel(Se)),E.add(re),E.add(ae),E.add(ve),E.add(Se)}async function co(t){const e=await navigator.xr.requestSession("immersive-vr"),n=e.inputSources[0];ve=e.requestReferenceSpace("local"),console.log("number of input sources:"+n.length)}function fo(){if(!V.xr.isPresenting)return;const t=ce.leftController.thumbstick,e=ce.rightController.thumbstick;Math.abs(t.y)>.1&&(E.position.z+=t.y*Ie.moveSpeed),Math.abs(t.x)>.1&&(E.position.x+=t.x*Ie.moveSpeed),Math.abs(e.x)>.1&&(E.rotation.y-=e.x*Ie.rotationSpeed)}function ut(){this.userData.isSelecting=!0}function pt(){this.userData.isSelecting=!1}function mo(){for(let t=Q.length-1;t>=0;t--){let e=Q[t],n=e.object.position;if(e.value=="e")if(n.x<=f.x/2)e.object.position.add(new o.Vector3(.2,0,0));else{e.object.position.add(new o.Vector3(.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x-f.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(g.remove(e.object),Q.splice(t,1))}else if(e.value=="h")if(n.x>=-f.x/2)e.object.position.add(new o.Vector3(-.2,0,0));else{e.object.position.add(new o.Vector3(-.2,0,0)),e.object.material.transparent=!0;let i=Math.abs(e.object.position.x+f.x/2),a=o.MathUtils.clamp(1-i/50,0,1);e.object.material.opacity=a,a<=0&&(g.remove(e.object),Q.splice(t,1))}}}function uo(){for(let t=J.length-1;t>=0;t--){let e=J[t],n=e.object.position;e.value=="e"?n.x<f.x/2-1?(p.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:X(),speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),J.splice(t,1)):e.object.position.add(new o.Vector3(-.2,0,0)):e.value=="h"&&(n.x>-f.x/2+1?(y.push({value:"h",crossReady:!0,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,recombine:!0,id:"generated",canMove:!0,object:e.object,material:e.material,velocity:X(),speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),J.splice(t,1)):e.object.position.add(new o.Vector3(.2,0,0)))}}function Pe(t,e){let n=0,i=0;for(let r=0;r<t.length;r++){let a=t[r].object.position.x;if(L<0||L>0){if(e=="e"){if(a>C/2&&(n=n+1,n>z)){n=n-1;let s=new o.Vector3(f.x/2-5,0,0),c=pe(s,2052607,!1);c.value="e",t[r].crossed=!0,Q.push(c);let l=Math.floor(Math.random()*p.length);g.remove(p[l].object),p[l].object.geometry.dispose(),p[l].object.material.dispose(),p.splice(l,1)}}else if(e=="h"&&a<-C/2&&(i=i+1,i>z)){i=i-1;let s=new o.Vector3(-f.x/2+5,0,0),c=pe(s,16724273,!1);c.value="h",t[r].crossed=!0,Q.push(c);let l=Math.floor(Math.random()*y.length);g.remove(y[l].object),y[l].object.geometry.dispose(),y[l].object.material.dispose(),y.splice(l,1)}}if(L===0){if(e=="e"){if(a>C/2&&(n=n+1,n>z)){n=n-1;let s=Math.floor(Math.random()*p.length);g.remove(p[s].object),p[s].object.geometry.dispose(),p[s].object.material.dispose(),p.splice(s,1)}}else if(e=="h"&&a<-C/2&&(i=i+1,i>z)){i=i-1;let s=Math.floor(Math.random()*y.length);g.remove(y[s].object),y[s].object.geometry.dispose(),y[s].object.material.dispose(),y.splice(s,1)}}}}function yt(t,e,n,i){for(let r=0;r<t.length;r++){let a=t[r].object.position.x,s=new o.Vector3(0,0,0);-e/2<a&&a<0&&(s=new o.Vector3(-1.53*(e/2+a),0,0)),0<a&&a<e/2&&(s=new o.Vector3(-1.53*(e/2-a),0,0)),(-f.x/2+1<a&&a<-e/2||e/2<a&&a<f.x/2-1||a==0)&&(s=new o.Vector3(0,0,0)),i<0?p[r].velocity.add(s.multiplyScalar(n).multiplyScalar(i)):y[r].velocity.add(s.multiplyScalar(n))}}function po(){for(let n of[...p,...y]){const i=n.velocity.clone();i.clampLength(.9,30),n.canMove==!0&&(n.object.position.add(i),n.velocity=i)}}function yo(){let i;for(let r=0;r<p.length;r++)for(let a=0;a<y.length;a++)!p[r]||!y[a]||(ft=p[r].object.position.x<-C/2-20||p[r].object.position.x>C/2+20,dt=y[a].object.position.x<-C/2-20||y[a].object.position.x>C/2+20,ft&&dt&&(wo(p[r],y[a])?!p[r].lerping&&!y[a].lerping&&(p[r].lerping=!0,y[a].lerping=!0,p[r].lerpPartner=y[a],y[a].lerpPartner=p[r],p[r].pauseCounter=0,y[a].pauseCounter=0,p[r].lerpProgress=0,y[a].lerpProgress=0,p[r].velocity.set(0,0,0),y[a].velocity.set(0,0,0),i=new o.Vector3().addVectors(p[r].object.position,y[a].object.position).multiplyScalar(.5),p[r].targetPosition=i.clone(),y[a].targetPosition=i.clone()):Xe=!1));for(let r of[...p,...y])if(r.processed=!1,r.lerping&&!r.processed)if(r.processed=!0,console.log("lerping detected"),r.orbCreated=!1,r.pauseCounter<60)r.pauseCounter++;else{if(r.lerpProgress+=.01,r.object.position.lerp(r.targetPosition,r.lerpProgress),r.lerpProgress<=.25&&!r.orb&&!r.orbCreated){const a=new o.SphereGeometry(3,32,32),s=new o.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),c=new o.Mesh(a,s);c.position.copy(r.targetPosition),r.orb=c,r.orb.gradualVal=3,r.orbCreated=!0,g.add(r.orb)}r.orb?(console.log("orb exists"),r.orb.position.copy(r.targetPosition),r.orb.scale.setScalar(r.orb.gradualVal),r.orb.gradualVal-=.05,r.orb.material.opacity=.3*Math.max(0,r.orb.gradualVal),r.orb.material.opacity<=.04?(g.remove(r.orb),r.orb.geometry.dispose(),r.orb.material.dispose(),r.orb=null,console.log("orb removed for recombination")):r.orb.material.opacity<=.1?(r.object.material.color.set(new o.Color(383487)),r.lerpPartner.object.material.color.set(new o.Color(16751792))):console.log("orb not removed yet")):console.log("orb does not exist"),r.lerpProgress>=.6&&bo(r,r.lerpPartner)}}function bo(t,e){g.remove(t.object),g.remove(e.object),p=p.filter(n=>n!==t&&n!==e),y=y.filter(n=>n!==t&&n!==e),[t,e].forEach(n=>{n.object.geometry.dispose(),n.object.material.dispose()}),Xe=!0}function go(){let t=new Te(o.MathUtils.randFloat(-10+Me.position.x,Pt/2+Me.position.x),o.MathUtils.randFloat(-He/2,He/2),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1));(t.x<-f.x/2+1||t.x>f.x/2-1||t.y>f.y/2-1||t.y<-f.y/2+1)&&(t.x=o.MathUtils.clamp(t.x,-f.x/2+1,f.x/2-1),t.y=o.MathUtils.clamp(t.y,-f.x/2+1,f.x/2-1));let e=pe(t.clone().add(new o.Vector3(2,0,0)),16724273,!1),n=pe(t.clone(),2052607,!1);e.velocity=new o.Vector3(-.02,0,0),n.velocity=new o.Vector3(.02,0,0);const i=new o.SphereGeometry(2,32,32),r=new o.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new o.Mesh(i,r);let s=e.object.position.clone().add(n.object.position.clone()).multiplyScalar(.5);a.position.copy(s),a.gradualVal=.5,g.add(a),Ve.push({hole:e,electron:n,orbSphere:a,position:t})}function vo(){let t=6;if(Ve.length>0){let e=0;for(let n of Ve){let i=n.hole,r=n.electron,a=n.orbSphere;if(a.gradualVal<=t&&a.material.opacity>0){i.object.position.add(i.velocity),r.object.position.add(r.velocity);let s=Math.max(0,1-(a.gradualVal-1)/(t-1));a.material.opacity=s,a.gradualVal+=.1}else g.remove(a),Ve.splice(e,1),y.push({value:"h",initPos:n.position.clone().add(new o.Vector3(2,0,0)),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:i.object,material:i.material,velocity:X(),speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3}),p.push({value:"e",initPos:n.position.clone(),crossReady:!1,crossed:!1,pause:!1,lerpProgress:0,lerping:!1,lerpPartner:new o.Vector3,id:"generated",recombine:!1,canMove:!0,object:r.object,material:r.material,velocity:X(),speed:Math.random()*(ue-D+1)+D,scatterStartTime:performance.now(),scatterTime:O+(Z.noise(Math.random(0,z)*100,Math.random(0,z)*200,performance.now()*.001)-.5)*.3});e++}}}function Mo(){for(let t of p)for(let e of y)if(t.initPos!=null&&e.initPos!=null){let n=t.object.position.distanceTo(t.initPos),i=e.object.position.distanceTo(e.initPos);n>ct&&i>ct&&(t.recombine=!0,e.recombine=!0)}}function wo(t,e){let n=new Te().subVectors(t.object.position,e.object.position).length(),i=20;if(t.recombine&&e.recombine)return n<=i}function X(){let t=ke[Math.floor(Math.random()*ke.length)],e=Math.random()*Math.PI,n=Math.random()*(2*Math.PI);const i=t*Math.sin(e)*Math.cos(n),r=t*Math.sin(e)*Math.sin(n),a=t*Math.cos(e);return new o.Vector3(i,r,a).multiplyScalar(ro)}function xo(t){for(let e=0;e<p.length;e++)for(let n=0;n<y.length;n++)(t-p[e].scatterStartTime)/1e3>=p[e].scatterTime&&(p[e].velocity=X(),p[e].scatterStartTime=performance.now(),p[e].scatterTime=O+(Z.noise(e*100,e*200,performance.now()*.001)-.5)*.3),(t-y[n].scatterStartTime)/1e3>=y[n].scatterTime&&(y[n].velocity=X(),y[n].scatterStartTime=performance.now(),y[n].scatterTime=O+(Z.noise(n*100,n*200,performance.now()*.001)-.5)*.3)}function ho(t,e,n,i){let r=f.y/2,a=-r,s=f.z/2,c=-s;for(let l=0;l<t.length;l++)t[l].object.position.x>=i?t[l].object.position.x=n+1:t[l].object.position.x<=n&&(t[l].object.position.x=o.MathUtils.randFloat(n+1,n+20)),t[l].object.position.y>r?(t[l].object.position.y=r-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.y<a&&(t[l].object.position.y=a+1,t[l].velocity.multiplyScalar(-1)),t[l].object.position.z>s?(t[l].object.position.z=s-1,t[l].velocity.multiplyScalar(-1)):t[l].object.position.z<c&&(t[l].object.position.z=c+1,t[l].velocity.multiplyScalar(-1));for(let l=0;l<e.length;l++)e[l].object.position.x>=i?e[l].object.position.x=o.MathUtils.randFloat(i-15,i-1):e[l].object.position.x<=n&&(e[l].object.position.x=i-1),e[l].object.position.y>r?(e[l].object.position.y=r-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.y<a&&(e[l].object.position.y=a+1,e[l].velocity.multiplyScalar(-1)),e[l].object.position.z>s?(e[l].object.position.z=s-1,e[l].velocity.multiplyScalar(-1)):e[l].object.position.z<c&&(e[l].object.position.z=c+1,e[l].velocity.multiplyScalar(-1))}function jo(){le.__controllers.forEach(t=>t.setValue(t.initialValue))}function bt(t,e,n,i){let r=3,a=.5;const s=new o.CapsuleGeometry(a,r);if(i=="acceptor"){let c=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),l=new o.Mesh(s,c);l.rotateZ(Math.PI/2),l.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),g.add(l)}else if(i=="donor"){let c=new o.CapsuleGeometry(a,r);c.rotateZ(Math.PI/2);let l=new Mt.mergeGeometries([s,c]),j=new o.MeshBasicMaterial({color:n,transparent:!0,opacity:.2}),w=new o.Mesh(l,j);w.position.set(o.MathUtils.randFloat(t,e),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),g.add(w)}}function gt(t,e,n,i,r){let a=null,s,c;s=new o.SphereGeometry(1,32,32),i===16724273?c=new o.MeshBasicMaterial({color:i,wireframe:!0}):c=new o.MeshBasicMaterial({color:i,transparent:r,opacity:a});const l=new o.Mesh(s,c);return l.position.set(o.MathUtils.randFloat(e,n),o.MathUtils.randFloat(-f.y/2+1,f.y/2-1),o.MathUtils.randFloat(-f.z/2+1,f.z/2-1)),g.add(l),{object:l,material:c}}function pe(t,e,n){let i=null,r,a;r=new o.SphereGeometry(1,32,32),e===16724273?a=new o.MeshBasicMaterial({color:e,wireframe:!0}):a=new o.MeshBasicMaterial({color:e,transparent:n,opacity:i});const s=new o.Mesh(r,a);return s.position.set(t.x,t.y,t.z),g.add(s),{object:s,material:a}}function So(t,e,n){let i=C/4;g.remove(Ue),Ue=new o.ArrowHelper(new o.Vector3(-1,0,0),t,e,n,i),g.add(Ue)}function Po(t,e,n,i){const r=new o.BufferGeometry,a=[-20/2,n,-i/2,t/2,n,-i/2,t/2,n,i/2,-20/2,n,i/2,-60/2,0,-i/2,e/2,0,-i/2,e/2,0,i/2,-60/2,0,i/2,-20/2,n,-i/2,-60/2,0,-i/2,-60/2,0,i/2,-20/2,n,i/2,t/2,n,-i/2,e/2,0,-i/2,e/2,0,i/2,t/2,n,i/2],s=[0,1,2,2,3,0,4,5,6,6,7,4,3,2,6,6,7,3,1,5,6,6,2,1,0,3,7,7,4,0,5,1,0,0,4,5];return r.setIndex(s),r.setAttribute("position",new o.BufferAttribute(new Float32Array(a),3)),r.computeVertexNormals(),r}function Ft(t,e,n){t=t*.5,e=e*.5,n=n*.5;const i=new o.BufferGeometry,r=[];return r.push(-t,-e,-n,-t,e,-n,-t,e,-n,t,e,-n,t,e,-n,t,-e,-n,t,-e,-n,-t,-e,-n,-t,-e,n,-t,e,n,-t,e,n,t,e,n,t,e,n,t,-e,n,t,-e,n,-t,-e,n,-t,-e,-n,-t,-e,n,-t,e,-n,-t,e,n,t,e,-n,t,e,n,t,-e,-n,t,-e,n),i.setAttribute("position",new o.Float32BufferAttribute(r,3)),i}function Fo(){I.aspect=B.clientWidth/B.clientHeight,I.updateProjectionMatrix(),V.setSize(B.clientWidth,B.clientHeight,!1),V.setPixelRatio(Math.min(window.devicePixelRatio,2))}
